
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="style.css">
	<title>fpworker</title>
</head>
<body>
	<div id="fingerprint" class="grid"></div>
	<script src="fpworker.js"></script>
	<script>
		;(async () => {
			// helpers
			const getHash = str => {
				if (typeof str === 'undefined') return
				const json = `${JSON.stringify(str)}`
				const hash = json.split('').reduce((hash, char, i) => {
					return Math.imul(31, hash) + json.charCodeAt(i) | 0
				}, 0x811c9dc5)
				return ('0000000' + (hash >>> 0).toString(16)).substr(-8)
			}
			const patch = (oldEl, newEl) => oldEl.parentNode.replaceChild(newEl, oldEl)
			const html = (str, ...expressionSet) => {
				const template = document.createElement('template')
				template.innerHTML = str.map((s, i) => `${s}${expressionSet[i] || ''}`).join('')
				return document.importNode(template.content, true)
			}

			// fingerprint
			const fp = await fpworker

			const getTemplate = ({ data, matcher = undefined }) => {
				const {
					// Blink
					canvasReadAsArrayBuffer,
					canvasReadAsBinaryString,
					canvasReadAsDataURL,
					canvasReadAsText,
					emojiUnique,
					emojiSum,
					fontsSupported,
					fontSystem,
					gpu,
					uaArchitecture,
					uaModel,
					uaPlatform,
					uaPlatformVersion,
					uaFullVersion,
					deviceMemory,
					// Blink/Gecko
					hardwareConcurrency,
					// Blink/Gecko/WebKit
					timeZone,
					language,
					languages,
					userAgent,
					platform,
					engine
				} = data || {}

				return `
					<div class="fail">engine: ${engine}</div>
					<div>timeZone: ${timeZone}</div>
					<div>language: ${language}</div>
					<div>languages: ${languages}</div>
					<div>platform: ${platform}</div>
					<div>userAgent: ${userAgent}</div>

					<div>hardwareConcurrency: ${hardwareConcurrency || ''}</div>

					<div>deviceMemory: ${deviceMemory || ''}</div>
					<div>gpu: ${gpu}</div>
					
					<div>fonts: ${fontsSupported}</div>
					<div>font system: ${fontSystem}</div>
					<div>ua platform: ${uaPlatform}</div>
					<div>ua platformVersion: ${uaPlatformVersion}</div>
					<div>ua architecture: ${uaArchitecture}</div>
					<div>ua model: ${uaModel}</div>
					<div>ua uaFullVersion: ${uaFullVersion}</div>
					<div>emojis: ${emojiUnique.join('')}</div>
					<div>emoji hash: ${getHash(emojiUnique)}</div>
					<div>emoji sum: ${emojiSum}</div>
					
					<div>canvas readAsArrayBuffer: ${getHash(canvasReadAsArrayBuffer)}</div>
					<div>canvas readAsBinaryString: ${getHash(canvasReadAsBinaryString)}</div>
					<div>canvas readAsDataURL: ${getHash(canvasReadAsDataURL)}</div>
					<div>canvas readAsText: ${getHash(canvasReadAsText)}</div>
				`
			}
			return patch(document.getElementById('fingerprint'), html`
				<div id="fingerprint" class="grid">
					<div class="header"><h1>fpworker</h1></div>
					<div class="window-scope">
						<h2>Window</h2>
						${getTemplate({ data: fp.windowScope })}
					</div>
					<div class="dedicated-worker">
						<h2>DedicatedWorkerGlobalScope</h2>
						${getTemplate({ data: fp.dedicatedWorker, matcher: fp.windowScope })}
					</div>
					<div class="service-worker">
						<h2>ServiceWorkerGlobalScope</h2>
						${getTemplate({ data: fp.serviceWorker, matcher: fp.windowScopee })}
					</div>
					<div class="shared-worker">
						<h2>SharedWorkerGlobalScope</h2>
						${getTemplate({ data: fp.sharedWorker, matcher: fp.windowScopee })}
					</div>
				</div>
			`)
		})()
	</script>
</body>
</html>